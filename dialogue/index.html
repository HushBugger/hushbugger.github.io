<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <script src="dialogue.js"></script>
    <style>
      body {
          background: darkgrey;
          font-family: Sans;
      }

      div.textbox {
          background: black;
          color: white;
          font-size: 10pt;
          font-family: "DTM Mono", Monospace;
          white-space: pre-wrap;
          width: 283px;
          padding: 5px;
          border: 2px solid white;
          margin-top: 5px;
      }

      span.red {
          color: #f00;
      }

      span.yellow {
          color: #ff0;
      }

      span.lightblue {
          color: #14a9ff;
      }

      span.blue {
          color: #00f;
      }

      span.green {
          color: #0f0;
      }

      span.orange {
          color: #ffa040;
      }

      @font-face {
          font-family: "DTM Mono";
          src: url('DTM-Mono.otf');
      }
    </style>
    <title>Undertale dialogue dump</title>
  </head>
  <body>
    <select id="characters" name="characters">
      <option value="">Select a character...</option>
      <option value="Everything">Everything</option>
    </select>
    <div id="textboxes">
    </div>
    <noscript>
      <p>Sorry, but you need to enable JavaScript to use this.</p>
    </noscript>
    <div class="credits">
      <p>
        Credits:
        <a href="https://www.behance.net/gallery/31268855/Determination-Better-Undertale-Font">Font</a>,
        <a href="https://docs.google.com/spreadsheets/d/1whOyrTlY-vTsEFjkg0UFSuO8mVqy4OUV8RqKFbky8tY">text dump</a>
      </p>
    </div>
    <script>
      "use strict";

      function render(text) {
          return text
              .replace(/\//g, '')
              .replace(/^\\W/g, '') // It's often at the start of the line for some reason
              .replace(/\\R/g, '<span class="red">')
              .replace(/\\Y/g, '<span class="yellow">')
              .replace(/\\L/g, '<span class="lightblue">')
              .replace(/\\B/g, '<span class="blue">')
              .replace(/\\G/g, '<span class="green">')
              .replace(/\\O/g, '<span class="orange">')
              .replace(/\\[WX]/g, '</span>')
              .replace(/[&#]/g, '\n')
              .replace(/\^[0-9]/g, '')
              .replace(/\/\*/g, '')
              .replace(/[%^]/g, '')
              .replace(/\\[EFMT]./, '')
              .replace(/\\./g, '');
      }

      function textbox(text) {
          var box = document.createElement('div');
          box.className = 'textbox';
          box.innerHTML = render(text);
          return box;
      }

      function addBoxes(character) {
          var boxes = document.getElementById('textboxes');
          for (var i = 0; i < d[character].length; i++) {
              boxes.appendChild(textbox(d[character][i]));
          }
      }

      function writeDialogue(character) {
          document.getElementById('textboxes').innerHTML = "";
          if (character === "" || (d[character] === undefined && character !== "Everything")) {
              document.title = "Undertale dialogue dump";
              window.location.hash = "";
              return;
          }
          document.title = "Undertale dialogue dump: " + character;
          window.location.hash = "#" + character;
          var options = document.getElementById('characters').childNodes;
          for (var i = 0; i < options.length; i++) {
              if (options[i].value === character) {
                  options[i].selected = true;
              }
          }
          if (character === "Everything") {
              var boxes = document.getElementById('textboxes');
              var characters = Object.keys(d);
              characters.sort()
              for (var i = 0; i < characters.length; i++) {
                  var heading = document.createElement('h1');
                  heading.appendChild(document.createTextNode(characters[i]));
                  boxes.appendChild(heading);
                  addBoxes(characters[i]);
              }
          } else {
              addBoxes(character);
          }
      }

      var characters = Object.keys(d);
      characters.sort();
      var select = document.getElementById('characters');
      for (var i = 0; i < characters.length; i++) {
          var option = document.createElement('option');
          option.value = characters[i];
          option.appendChild(document.createTextNode(characters[i]));
          select.options.add(option);
      }

      document.addEventListener('DOMContentLoaded', function() {
          document.querySelector('select[name="characters"]').
              onchange=function(event) {
                  writeDialogue(event.target.value);
              };
      }, false);

      window.onhashchange = function() {
          writeDialogue(decodeURIComponent(window.location.hash.substr(1)));
      }

      if (window.location.hash !== "") {
          window.onhashchange();
      }
    </script>
  </body>
</html>
